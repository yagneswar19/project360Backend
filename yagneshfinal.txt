================================================================================
                        REWARDS360 - PROJECT DOCUMENTATION
                              (yagneshfinal)
================================================================================

Project Name    : Rewards360 Loyalty Platform
Tech Stack      : Spring Boot 3.2.5, Java 17, MySQL, JWT Authentication
Build Tool      : Maven
Frontend        : React (Vite + JSX)
Database        : MySQL (default) / SQL Server (alternate profile)
ORM             : Spring Data JPA (Hibernate)
Security        : Spring Security + JWT (JJWT 0.11.5)
Password Hashing: BCrypt

================================================================================
                        WHAT THIS PROJECT DOES
================================================================================

Rewards360 is a Customer Loyalty & Rewards Management Platform. It allows:

  1. USERS to:
     - Register and login to the platform
     - View their loyalty profile (points balance, tier, preferences)
     - Claim reward points for activities
     - Browse available offers (filtered by their loyalty tier)
     - Redeem offers by spending points
     - View transaction history (claims + redemptions)
     - View redemption history with confirmation codes

  2. ADMINS to:
     - Create and manage promotional campaigns
     - Create and manage reward offers
     - Monitor fraud alerts and anomalies
     - View audit logs for user activities

  3. LOYALTY TIER SYSTEM (automatic):
     - Bronze  :     0 - 1,999 lifetime points
     - Silver  : 2,000 - 4,999 lifetime points
     - Gold    : 5,000 - 9,999 lifetime points
     - Platinum: 10,000+ lifetime points
     - Tier upgrades automatically based on lifetime points earned
     - Tier never decreases when spending/redeeming points

  4. NEW USER REGISTRATION:
     - Every new user starts with 2,000 points (Silver tier)
     - Users choose communication preferences (Email/SMS/WhatsApp)
     - Users set category preferences

================================================================================
                        DATABASE MODELS / ENTITIES
================================================================================

  1. User          - id, name, email (unique), phone, password, role (ADMIN/USER)
                     Has one-to-one link to CustomerProfile

  2. CustomerProfile - id, loyaltyTier, pointsBalance, lifetimePoints,
                       nextExpiry, preferences, communication, userId
                       Auto-updates tier via JPA @PrePersist and @PreUpdate

  3. Offer         - id, title, category, description, costPoints, imageUrl,
                     active, tierLevel (Bronze/Silver/Gold/Platinum/null)

  4. Transaction   - id, externalId, type (CLAIM/REDEMPTION/PURCHASE),
                     pointsEarned, pointsRedeemed, store, date, expiry,
                     note, userId

  5. Redemption    - id, confirmationCode, transactionId, date, costPoints,
                     offerTitle, store, userId

  6. Campaign      - id, title, discountType, category, imageUrl, costPoints,
                     startDate, endDate, description, addToOffers

  7. FraudAlert    - id, severity (HIGH/MEDIUM/LOW), message, refTxnId

  8. Anomaly       - id, title, detail

  9. AuditLog      - id, userName, action, date

 10. Role (Enum)   - ADMIN, USER

================================================================================
                        ALL API ENDPOINTS
================================================================================

BASE URL: http://localhost:8080

------------------------------------------------------------------------------
 AUTHENTICATION ENDPOINTS (Public - No Token Required)
 Base Path: /api/auth
------------------------------------------------------------------------------

  1. POST /api/auth/register
     - Purpose   : Register a new user
     - Request   : { name, email, phone, password, role, preferences, communication }
     - Validations: email format, phone 10 digits, password min 8 chars
     - Response  : 200 OK (empty body)
     - Logic     : Creates user + customer profile, starts with 2000 points,
                   Bronze tier (auto-upgraded to Silver by lifecycle callback)

  2. POST /api/auth/login
     - Purpose   : Login and get JWT token
     - Request   : { email, password }
     - Response  : { token, role }
     - Logic     : Authenticates via Spring Security, generates JWT token
                   valid for 24 hours (86400000 ms)

------------------------------------------------------------------------------
 USER ENDPOINTS (Requires JWT Token - Role: USER or ADMIN)
 Base Path: /api/user
------------------------------------------------------------------------------

  3. GET /api/user/me
     - Purpose   : Get current logged-in user's profile
     - Auth      : Bearer JWT Token
     - Response  : Full User object with CustomerProfile (points, tier, etc.)

  4. GET /api/user/offers
     - Purpose   : Get all available offers
     - Auth      : Bearer JWT Token
     - Response  : List of all Offer objects

  5. GET /api/user/offers/my-tier
     - Purpose   : Get offers available for user's loyalty tier
     - Auth      : Bearer JWT Token
     - Logic     : Platinum sees all offers, Gold sees Gold+Silver+Bronze,
                   Silver sees Silver+Bronze, Bronze sees only Bronze
     - Response  : Filtered list of Offer objects sorted by cost (ascending)

  6. POST /api/user/claim
     - Purpose   : Claim reward points
     - Auth      : Bearer JWT Token
     - Request   : { activityCode, points, note }
     - Response  : Transaction object
     - Logic     : Adds points to balance, adds to lifetime points,
                   creates CLAIM transaction, sets 3-month expiry,
                   auto-upgrades tier if threshold crossed

  7. POST /api/user/redeem
     - Purpose   : Redeem an offer using points
     - Auth      : Bearer JWT Token
     - Request   : { offerId, store }
     - Response  : Redemption object with confirmation code
     - Logic     : Validates offer exists, checks sufficient points,
                   deducts points, creates REDEMPTION transaction,
                   generates confirmation code (CONF-timestamp)
     - Errors    : 404 if offer not found, 400 if insufficient points

  8. GET /api/user/transactions
     - Purpose   : Get all transactions for logged-in user
     - Auth      : Bearer JWT Token
     - Response  : List of Transaction objects (newest first)

  9. GET /api/user/redemptions
     - Purpose   : Get all redemptions for logged-in user
     - Auth      : Bearer JWT Token
     - Response  : List of Redemption objects (newest first)

------------------------------------------------------------------------------
 ADMIN ENDPOINTS (Requires JWT Token - Role: ADMIN only)
 Base Path: /api/admin
------------------------------------------------------------------------------

 10. POST /api/admin/campaigns
     - Purpose   : Create a new promotional campaign
     - Auth      : Bearer JWT Token (ADMIN role)
     - Request   : Campaign object (title, discountType, category, imageUrl,
                   costPoints, startDate, endDate, description, addToOffers)
     - Response  : Created Campaign object

 11. GET /api/admin/campaigns
     - Purpose   : Get all campaigns
     - Auth      : Bearer JWT Token (ADMIN role)
     - Response  : List of all Campaign objects

 12. POST /api/admin/offers
     - Purpose   : Create a new offer
     - Auth      : Bearer JWT Token (ADMIN role)
     - Request   : Offer object (title, category, description, costPoints,
                   imageUrl, tierLevel)
     - Logic     : Automatically sets active = true
     - Response  : Created Offer object

 13. GET /api/admin/offers
     - Purpose   : Get all offers (admin view)
     - Auth      : Bearer JWT Token (ADMIN role)
     - Response  : List of all Offer objects

 14. GET /api/admin/fraud/alerts
     - Purpose   : Get all fraud alerts
     - Auth      : Bearer JWT Token (ADMIN role)
     - Response  : List of FraudAlert objects (severity, message, refTxnId)

 15. GET /api/admin/fraud/anomalies
     - Purpose   : Get all detected anomalies
     - Auth      : Bearer JWT Token (ADMIN role)
     - Response  : List of Anomaly objects (title, detail)

 16. GET /api/admin/fraud/audit
     - Purpose   : Get audit log entries
     - Auth      : Bearer JWT Token (ADMIN role)
     - Response  : List of AuditLog objects (userName, action, date)

================================================================================
                        SECURITY CONFIGURATION
================================================================================

  - Stateless session (no cookies, JWT only)
  - CSRF disabled (REST API)
  - CORS enabled for http://localhost:5173 (Vite frontend)
  - Public endpoints   : /api/auth/** (register, login)
  - Admin endpoints    : /api/admin/** (requires ROLE_ADMIN)
  - All other endpoints: require authentication (valid JWT)
  - JWT Filter runs before UsernamePasswordAuthenticationFilter
  - Passwords hashed with BCrypt

================================================================================
                        OPERATIONS / BUSINESS LOGIC
================================================================================

  1. USER REGISTRATION FLOW:
     -> User sends POST /api/auth/register with details
     -> System creates User entity + CustomerProfile entity
     -> Starting balance = 2,000 points
     -> Tier auto-calculated (Silver for 2,000 points)
     -> Password encrypted with BCrypt before saving

  2. LOGIN FLOW:
     -> User sends POST /api/auth/login with email + password
     -> Spring Security AuthenticationManager validates credentials
     -> On success, JWT token generated with 24h expiry
     -> Token + role returned to client

  3. CLAIM POINTS FLOW:
     -> Authenticated user sends POST /api/user/claim
     -> New Transaction created (type=CLAIM, externalId=CLAIM-timestamp)
     -> Points added to user's pointsBalance
     -> Points added to user's lifetimePoints
     -> Tier auto-recalculated via JPA lifecycle callback
     -> Expiry set to 3 months from claim date

  4. REDEEM OFFER FLOW:
     -> Authenticated user sends POST /api/user/redeem
     -> System finds offer by ID (404 if not found)
     -> Checks user has enough points (400 if insufficient)
     -> Deducts offer cost from user's pointsBalance
     -> Creates Transaction (type=REDEMPTION, externalId=RED-timestamp)
     -> Creates Redemption record with confirmation code
     -> Tier NOT decreased (based on lifetime, not current balance)

  5. TIER-BASED OFFERS:
     -> GET /api/user/offers/my-tier returns offers filtered by tier
     -> Higher-tier users can see lower-tier offers
     -> Offers with tierLevel=null are visible to all users
     -> Results sorted by cost points ascending


================================================================================
                        ERROR HANDLING
================================================================================

  - UserNotFoundException   -> 404 Not Found
  - OfferNotFoundException  -> 404 Not Found
  - InsufficientPointsException -> 400 Bad Request
  - Any other Exception     -> 500 Internal Server Error
  - All errors return: { message, statusCode }

================================================================================
                        PROJECT STRUCTURE
================================================================================

  backend/
  ├── pom.xml                          (Maven build config)
  ├── src/main/java/com/rewards360/
  │   ├── Rewards360Application.java   (Main Spring Boot entry point)
  │   ├── config/
  │   │   └── SecurityConfig.java      (Security, JWT filter, CORS)
  │   ├── controller/
  │   │   ├── AuthController.java      (Register + Login endpoints)
  │   │   ├── UserController.java      (User-facing endpoints)
  │   │   └── AdminController.java     (Admin-only endpoints)
  │   ├── dto/
  │   │   ├── AuthResponse.java        (token + role response)
  │   │   ├── ClaimRequest.java        (activityCode, points, note)
  │   │   ├── LoginRequest.java        (email, password)
  │   │   ├── RedeemRequest.java       (offerId, store)
  │   │   └── RegisterRequest.java     (name, email, phone, password, role, etc.)
  │   ├── exception/
  │   │   ├── ErrorResponse.java       (message + statusCode)
  │   │   ├── GlobalExceptionHandler.java
  │   │   ├── InsufficientPointsException.java
  │   │   ├── OfferNotFoundException.java
  │   │   └── UserNotFoundException.java
  │   ├── model/
  │   │   ├── Anomaly.java
  │   │   ├── AuditLog.java
  │   │   ├── Campaign.java
  │   │   ├── CustomerProfile.java     (with auto tier calculation)
  │   │   ├── FraudAlert.java
  │   │   ├── Offer.java
  │   │   ├── Redemption.java
  │   │   ├── Role.java                (ADMIN, USER enum)
  │   │   ├── Transaction.java
  │   │   └── User.java
  │   ├── repository/                  (JPA Repositories for all entities)
  │   └── service/
  │       ├── CustomUserDetailsService.java
  │       ├── JwtAuthFilter.java       (JWT token filter for requests)
  │       ├── JwtService.java          (JWT generate, validate, extract)
  │       └── PointsService.java       (Claim + Redeem business logic)
  └── src/main/resources/
      ├── application.properties       (MySQL config, JWT secret)
      ├── application-sqlserver.properties
      └── data.sql                     (Seed data)

  frontend/                            (React + Vite frontend)
  ├── src/pages/auth/                  (Login, Register, ForgotPassword, OTP)
  ├── src/pages/user/                  (Dashboard, Offers, Profile, etc.)
  ├── src/pages/admin/                 (Campaigns, Fraud, Reports, etc.)
  └── src/api/client.js                (Axios API client)

================================================================================
                        HOW TO RUN
================================================================================

  Prerequisites: Java 17, Maven, MySQL running on localhost:3306

  1. Start MySQL and ensure database "revanth" exists (auto-created)
  2. Navigate to backend/ folder
  3. Run: mvn spring-boot:run
  4. Backend starts on: http://localhost:8080
  5. For frontend: cd frontend/ && npm install && npm run dev
  6. Frontend runs on: http://localhost:5173

================================================================================
                        ENDPOINT SUMMARY TABLE
================================================================================

  METHOD  | ENDPOINT                    | AUTH     | ROLE   | DESCRIPTION
  --------|-----------------------------|---------:|--------|------------------
  POST    | /api/auth/register          | None     | Any    | Register user
  POST    | /api/auth/login             | None     | Any    | Login, get JWT
  GET     | /api/user/me                | JWT      | Any    | Get my profile
  GET     | /api/user/offers            | JWT      | Any    | All offers
  GET     | /api/user/offers/my-tier    | JWT      | Any    | Tier-filtered offers
  POST    | /api/user/claim             | JWT      | Any    | Claim points
  POST    | /api/user/redeem            | JWT      | Any    | Redeem an offer
  GET     | /api/user/transactions      | JWT      | Any    | My transactions
  GET     | /api/user/redemptions       | JWT      | Any    | My redemptions
  


================================================================================
                     END OF DOCUMENTATION
================================================================================
